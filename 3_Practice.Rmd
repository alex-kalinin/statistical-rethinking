---
title: "Chapter 3 -- Practice"
output: 
  pdf_document: 
    fig_caption: yes
---

```{r setup, include=F}
# knitr::opts_chunk$set(echo = FALSE)
rm(list=ls())
library(rethinking)
```

```{r}
p_grid = seq(from=0, to=1, length.out=1000)
prior <- rep(1, 1000)
likelihood <- dbinom(6, size=9, prob=p_grid)
posterior <- likelihood * prior
posterior <- posterior / sum(posterior)
set.seed(100)
samples <- sample(p_grid, prob=posterior, size=1e4, replace=T)
```

```{r}
par(mfrow=c(1, 2))
plot(samples)
plot(density(samples, adjust = 0.5), main="")
```

### 3E1. How much posterior probability lies below p = 0.2?
```{r}
sum(posterior[p_grid < 0.2])
sum(samples < 0.2) / length(samples)
```

### 3E2. How much posterior probability lies above p = 0.8?
```{r}
sum(posterior[p_grid > 0.8])
sum(samples > 0.8) / length(samples)
```
### 3E3. How much posterior probability lies between p = 0.2 and p = 0.8?
```{r}
sum(posterior[p_grid > 0.2 & p_grid < 0.8])
sum(samples > 0.2 & samples < 0.8) / length(samples)
```

### 3E4. 20% of the posterior probability lies below which value of p?
```{r}
quantile(samples, 0.2)
```

### 3E5. 20% of the posterior probability lies above which value of p?
```{r}
quantile(samples, 0.8)
```

### 3E6. Which values of p contain the narrowest interval equal to 66% of the posterior probability?
```{r}
samples_for_hpdi <- coda::as.mcmc(samples)
# x <- sapply(0.66, function(p) coda::HPDinterval(samples_for_hpdi,  prob = p))
x <- coda::HPDinterval(samples_for_hpdi, prob=0.66)
c(x[1], x[2])
HPDI(samples, prob=0.66)
```

### 3E7. Which values of p contain 66% of the posterior probability, assuming equal posterior probability both below and above the interval?
```{r}
low = (1 - 0.66) / 2
up = low + 0.66
interval = c(low, up)
c(interval, interval[2] - interval[1])
quantile(samples, interval)
```

If the distribution is not too skewed then the Percentile Interval (PI) will approximately equal to the Highest Posterior Density Interval (HPDI):

* PI: (0.501, 0.769)
* HPDI: (0.521, 0.785)
